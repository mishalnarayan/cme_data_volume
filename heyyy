      // Detect visible iframes and objects that take significant space on the page
      const embeddedFrames = [];
      const frameSelectors = 'iframe[src], object[data], embed[src]';
      const vpW = window.innerWidth || document.documentElement.clientWidth;
      const vpH = window.innerHeight || document.documentElement.clientHeight;
      const vpArea = vpW * vpH;
      const MIN_FRAME_W = 200;
      const MIN_FRAME_H = 150;
      const MIN_VP_PERCENT = 0.10; // at least 10% of viewport area
      try {
        const frames = document.querySelectorAll(frameSelectors);
        frames.forEach((frame, idx) => {
          try {
            const rect = frame.getBoundingClientRect();
            const frameArea = rect.width * rect.height;
            // Only include frames taking significant UI space
            if (rect.width < MIN_FRAME_W || rect.height < MIN_FRAME_H) return;
            if (frameArea / vpArea < MIN_VP_PERCENT) return;
            const style = window.getComputedStyle(frame);
            if (style.display === 'none' || style.visibility === 'hidden' || parseFloat(style.opacity) <= 0) return;

            const tag = frame.tagName.toLowerCase();
            const url = frame.getAttribute('src') || frame.getAttribute('data') || '';
            if (!url || url.startsWith('about:') || url.startsWith('javascript:')) return;

            // Resolve to absolute URL
            let absoluteUrl = url;
            try { absoluteUrl = new URL(url, window.location.href).href; } catch (_) {}

            // Friendly label from URL
            let label = absoluteUrl;
            try {
              const u = new URL(absoluteUrl);
              label = u.hostname + (u.pathname !== '/' ? u.pathname : '');
              if (label.length > 60) label = label.slice(0, 57) + 'â€¦';
            } catch (_) {}

            embeddedFrames.push({
              id: `frame_${idx}`,
              tag,
              url: absoluteUrl,
              label,
              area: Math.round(rect.width * rect.height),
              selector: getElementSelector(frame)
            });
          } catch (_) {}
        });
      } catch (_) {}
      
      return {
        success: true,
        analysis: {
          top_sections: topSections,
          total_sections_found: topSections.length,
          containers_removed: elementsToRemove.size,
          embedded_frames: embeddedFrames
        }
      };
    };
